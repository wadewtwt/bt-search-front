<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zhelper Search Page 搜索界面 🔍</title>
    <meta name="description" content="zhelper Search Page 搜索界面 🔍">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7692266966719684"
            crossorigin="anonymous"></script>
    <link href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap/5.1.3/css/bootstrap.min.css" type="text/css"
          rel="stylesheet" />
    <script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap/5.1.3/js/bootstrap.bundle.min.js"
            type="application/javascript"></script>
    <script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/axios/0.26.0/axios.min.js"
            type="application/javascript"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Manrope">
    <script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/vue/3.2.31/vue.global.min.js"
            type="application/javascript"></script>
</head>

<body>

<div class="container" id="app">
    <nav class="navbar navbar-expand-lg  navbar-light">
        <div class="container-fluid">
            <b>zhelper search</b>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false"
                    aria-label="Toggle navigation">
                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid meet"
                     viewBox="0 0 24 24">
                    <path fill="currentColor" d="m12 15.375l-6-6l1.4-1.4l4.6 4.6l4.6-4.6l1.4 1.4Z" />
                </svg>
            </button>
            <div class="collapse navbar-collapse pull-right" id="navbarTogglerDemo02">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <!-- <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#">{{language.home}}</a>
                        </li> -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <!-- {{language.api}} -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                                 preserveAspectRatio="xMidYMid meet" viewBox="0 0 1024 1024">
                                <path fill="currentColor"
                                      d="m917.7 148.8l-42.4-42.4c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-76.1 76.1a199.27 199.27 0 0 0-112.1-34.3c-51.2 0-102.4 19.5-141.5 58.6L432.3 308.7a8.03 8.03 0 0 0 0 11.3L704 591.7c1.6 1.6 3.6 2.3 5.7 2.3c2 0 4.1-.8 5.7-2.3l101.9-101.9c68.9-69 77-175.7 24.3-253.5l76.1-76.1c3.1-3.2 3.1-8.3 0-11.4zM769.1 441.7l-59.4 59.4l-186.8-186.8l59.4-59.4c24.9-24.9 58.1-38.7 93.4-38.7c35.3 0 68.4 13.7 93.4 38.7c24.9 24.9 38.7 58.1 38.7 93.4c0 35.3-13.8 68.4-38.7 93.4zm-190.2 105a8.03 8.03 0 0 0-11.3 0L501 613.3L410.7 523l66.7-66.7c3.1-3.1 3.1-8.2 0-11.3L441 408.6a8.03 8.03 0 0 0-11.3 0L363 475.3l-43-43a7.85 7.85 0 0 0-5.7-2.3c-2 0-4.1.8-5.7 2.3L206.8 534.2c-68.9 69-77 175.7-24.3 253.5l-76.1 76.1a8.03 8.03 0 0 0 0 11.3l42.4 42.4c1.6 1.6 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3l76.1-76.1c33.7 22.9 72.9 34.3 112.1 34.3c51.2 0 102.4-19.5 141.5-58.6l101.9-101.9c3.1-3.1 3.1-8.2 0-11.3l-43-43l66.7-66.7c3.1-3.1 3.1-8.2 0-11.3l-36.6-36.2zM441.7 769.1a131.32 131.32 0 0 1-93.4 38.7c-35.3 0-68.4-13.7-93.4-38.7a131.32 131.32 0 0 1-38.7-93.4c0-35.3 13.7-68.4 38.7-93.4l59.4-59.4l186.8 186.8l-59.4 59.4z" />
                            </svg>
                            <span v-if="!api.name">{{language.apinotset}}</span>
                            {{api.name}}
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <li v-if="noapi" class="dropdown-item">
                                {{language.noapi}}
                            </li>
                            <li v-for="api in apis" class="dropdown-item" :key="api.id" @click="changeapi(api)">
                                {{api.name}}
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/zhelper-org/search-page"><svg
                                xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                                preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24">
                            <path fill="currentColor"
                                  d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z" />
                        </svg></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="d-grid gap-2 d-flex justify-content-center">
        <div class="input-group">
            <input type="text" class="form-control" placeholder="" @keyup.enter="search" v-model="keyword">
            <button class="btn btn-primary" @click="search">搜索</button>
        </div>
    </div>
    <div class="my-5 mx-auto">
        <ol class="list-group list-group-flush">
            <a v-for="result in search_result" @click="get_detail(result)"
               class=" list-group-item list-group-item-action " aria-current="true" style="text-align: left">
                <div class="ms-2 align-items-start" style="text-align: start;">
                    <template v-if="result.info">
                        <b class="card-title">{{result.info}}</b>
                        {{language.source}}：{{result.source}}
                    </template>
                    <template v-if="result.title">
                        <b class="card-title">{{result.title}}</b>
                        {{language.author}}：{{result.author}}，{{language.publisher}}：{{result.publisher}}，{{language.year}}：{{result.year}}，
                        {{language.source}}：{{result.source}}
                        <br>
                        <p class="fw-light">
                            <small>
                                {{language.filesize}}：{{filesizeToString(result.filesize)}}，ID：{{result.id}}，ISBN：{{result.isbn}}，{{language.extension}}：{{result.extension}}
                            </small>
                        </p>
                    </template>
                </div>
            </a>
        </ol>
    </div>
    <nav aria-label="Page navigation example" v-if="search_result.length">
        <ul class="pagination justify-content-center">

            <li v-if="page-1" class="page-item">
                <a class="page-link" href="#" @click="change_page(-1)">前一页</a>
            </li>
            <li class="page-item"><a class="page-link" href="#">{{page}}</a></li>
            <li v-if="page!= total_page" class="page-item">
                <a class="page-link" href="#" @click="change_page(1)">后一页</a>
            </li>
        </ul>
    </nav>

    <div v-if="is_homepage && !search_result.length">
        <h1>使用须知</h1>
        <ul>
            <li>本网页本身不具备任何搜索或者下载功能，需要搭配合适的查询接口进行使用 <b>直接访问将显示无可用API</b></li>
            <li>点击搜索后，本网页将向查询接口发送查询信息，接口返回结果需要一定时间，请耐心等待，不要重复查询</li>
            <li>本网页所显示的查询结果完全取决于接口所返回的内容。请不要使用来历不明的接口，我们不对接口内容负责</li>
            <li>通过更改查询接口，可以实现不同内容的混合查询</li>
            <li>本网页已经开源</li>
        </ul>
    </div>
    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg ">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">详细结果</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

                </div>
                <div class="modal-body">

                    <template v-if=" api.type == 'full'">
                        {{language.title}}：{{detail.title}}，
                        {{language.source}}：{{detail.source}}
                        <br>
                        {{language.author}}：{{detail.author}}，{{language.publisher}}：{{detail.publisher}}，{{language.year}}：{{detail.year}}
                        <br>
                        MD5： {{detail.md5}}
                        <br>
                        {{language.filesize}}：{{detail.filesize}}
                    </template>
                    <template v-if="api.type == 'light'">
                        {{language.info}}：{{detail.info}}，
                        {{language.source}}：{{detail.source}}
                    </template>


                    <p></p>
                    <div class="modal-footer">
                        <template v-if="api.type == 'full'">
                            <a v-if="detail.in_libgen" class="btn btn-secondary"
                               :href="'http://libgendown.1kbtool.com/'+detail.md5" target="_blank">
                                Libgen
                            </a>
                            <a v-if="detail.ipfs_cid !== null && detail.ipfs_cid" class="btn btn-secondary"
                               :href="'https://ipfs-checker.1kbtool.com/'+detail.ipfs_cid+'?filename='+detail.title+'_'+detail.author+'_zhelper-search.'+detail.extension"
                               target="_blank">
                                IPFS
                            </a>
                            <a v-if="detail.md5" class="btn btn-secondary"
                               :href="'https://rapidupload.1kbtool.com/'+detail.md5 + '#' + detail.filesize + '#' + detail.title + '_' + detail.author + '_zhelper-search.' + detail.extension"
                               target="_blank">
                                秒传
                            </a>
                            <a v-if="detail.zlib_download" class="btn btn-secondary"
                               :href="'https://zlib.download/download/'+detail.id" target="_blank">
                                zlib.download
                            </a>
                        </template>
                        <template v-if="api.type == 'light'">
                            <a :href="detail.url" class="btn btn-secondary" target="_blank">
                                {{ language.direct_url }}
                            </a>

                            <button class="btn btn-primary" v-if="detail.download_link"
                                    data-bs-target="#downloadModal"
                                    data-bs-toggle="modal">{{language.download_links}}</button>
                        </template>
                        <!-- 可能需要 eval 一下，解释两次
                        <a v-for="methods in download_config"  :hidden="!methods.condition" :href="methods.url" target="_blank" class="btn btn-secondary">
                            {{ methods.name }}
                        </a> -->

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="downloadModal" tabindex="-1" aria-labelledby="downloadModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg ">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">下载链接</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

                </div>
                <div class="modal-body">
                    {{language.info}}：{{detail.info}}，
                    {{language.source}}：{{detail.source}}

                    <p></p>
                    <div class="modal-footer">
                        <a v-for="download_link in detail.download_link" :href="download_link.url" class="btn btn-secondary" target="_blank">
                            {{ download_link.name }}
                        </a>
                        <!-- 可能需要 eval 一下，解释两次
                        <a v-for="methods in download_config"  :hidden="!methods.condition" :href="methods.url" target="_blank" class="btn btn-secondary">
                            {{ methods.name }}
                        </a> -->

                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
        <div class="col-md-4 d-flex text-center" style="margin-left: 4px">
            <span class="mb-3 mb-md-0 text-muted  text-center">© 2022 Zhelper Team</span>
        </div>
    </footer>

</div>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7692266966719684"
        crossorigin="anonymous"></script>
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7692266966719684" data-ad-slot="3408254862"
     data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<script>

    function getCookie(name) {
        // 拆分 cookie 字符串
        var cookieArr = document.cookie.split(";");

        // 循环遍历数组元素
        for (var i = 0; i < cookieArr.length; i++) {
            var cookiePair = cookieArr[i].split("=");

            /* 删除 cookie 名称开头的空白并将其与给定字符串进行比较 */
            if (name == cookiePair[0].trim()) {
                // 解码cookie值并返回
                return decodeURIComponent(cookiePair[1]);
            }
        }
        // 如果未找到，则返回null
        return null;
    }

    const app = Vue.createApp({
        data() {
            return {
                inprogress: false,
                language: {
                    changeapi: '切换API',
                    home: '返回首页',
                    doc: '查看文档',
                    title: '书名',
                    author: '作者',
                    publisher: '出版社',
                    year: '出版时间',
                    filesize: '文件大小',
                    extension: '文件类型',
                    source: '书源',
                    info: '信息',
                    noapi: '无可用API',
                    apinotset: '未指定API',
                    direct_url: '直达链接',
                    download_links: '下载链接'
                },
                api: {},
                apis: [],
                search_result: [],
                detail: {},
                keyword: '',
                hits: 0,
                page: 1,
            }
        },
        methods: {
            changeapi(api) {
                this.api = api
            },
            search() {
                this.page = 1;
                this.inprogress = true;
                axios.post(this.api.url + '/api/search/', {
                    keyword: this.keyword,
                    page: this.page,
                    sensitive: this.api.sensitive,
                }).then(response => {
                    if (response.data.errorn) {
                        alert(response.data.msg)
                    }
                    else {
                        this.search_result = response.data.data
                        if(response.data.data.length == 0){
                            alert('无相关结果')
                        }
                        this.hits = response.data.hits
                    }
                }).catch(error => {
                    if (error.toJSON().status == 429) {
                        alert('请求过于频繁，请稍等一下再次尝试(429)')
                    }
                    else {
                        alert(`未知错误，请打开控制台查看(${error.message})`)
                    }
                })
                this.inprogress = false;
            },
            change_page(change) {
                this.page += change
                axios.post(this.api.url + '/api/search/', {
                    keyword: this.keyword,
                    page: this.page,
                    sensitive: this.api.sensitive,
                }).then(response => {
                    this.search_result = response.data.data
                }).catch(error => {
                    if (error.toJSON().status == 429) {
                        alert('请求过于频繁，请稍等一下再次尝试(429)')
                    }
                    else {
                        alert(`未知错误，请打开控制台查看(${error.message})`)
                    }
                })
            },
            get_detail(item) {
                if (this.api.detail) {
                    axios.post(this.api.url + '/api/detail/', {
                        id: item.id,
                        source: item.source
                    }).then(response => {
                        if (response.data.errorn) {
                            alert(response.data.msg)
                        }
                        else {
                            this.detail = response.data
                        }

                    }).catch(error => {
                        if (error.toJSON().status == 429) {
                            alert('请求过于频繁，请稍等一下再次尝试(429)')
                        }
                        else {
                            alert(`未知错误，请打开控制台查看(${error.message})`)
                        }
                    })
                }
                else {
                    this.detail = item;
                }
                var myModal = new bootstrap.Modal(document.getElementById('detailModal'), {})
                myModal.toggle()
            },
            filesizeToString(filesize) {
                if (filesize > 0 && filesize < 1) {
                    return (filesize * 8).toFixed(2).toString() + 'b'
                } else if (filesize <= 1024) {
                    return filesize.toFixed(2).toString() + 'B'
                } else if (filesize <= Math.pow(1024, 2)) {
                    return (filesize / 1024).toFixed(2).toString() + 'KB'
                } else if (filesize <= Math.pow(1024, 3)) {
                    return (filesize / Math.pow(1024, 2)).toFixed(2).toString() + 'MB'
                }
            }
        },
        computed: {
            is_homepage() {
                return location.pathname == '/'
            },
            noapi() {
                return this.apis.length == 0
            },
            total_page() {
                return Math.floor(this.hits / 20) + 1
            },
        },
        mounted: function () {
            this.apis = JSON.parse(decodeURI(location.search.slice(1)));
            this.api = this.apis[0]
        }
    })
    app.mount('#app')

</script>

</body>

</html>
